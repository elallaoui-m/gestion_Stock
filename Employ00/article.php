<?php
/* Displays user information and some useful messages */
session_start();

// Check if user is logged in using the session variable
if ( $_SESSION['logged_in'] != 1 ) {
  $_SESSION['message'] = "You must log in first!";
  header("location: error.php");    
}
else {
    // Makes it easier to read
    $first_name = $_SESSION['first_name'];
    $last_name = $_SESSION['last_name'];
    $email = $_SESSION['email'];
    //$active = $_SESSION['active'];
}
?>


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Gestionnaire De Stock</title>
	<link rel="stylesheet" href="css/style.css" type="text/css" media="all" />
</head>
<body>
<!-- Header -->
<div id="header">
	<div class="shell">
		<!-- Logo + Top Nav -->
		<div id="top">
			<h1><a href="#">Articles</a></h1>
			<div id="top-navigation">
				Bonjour, <a href="profile.php"><strong><?php echo $first_name ; ?></strong></a>
				<span>|</span>
				<a href="modif/modif_usr.php">Parametres De Profile</a>
				<span>|</span>
				<a href="logout.php">Déconnexion</a>
			</div>
		</div>
		<!-- End Logo + Top Nav -->
		
		<!-- Main Nav -->
		<div id="navigation">
			<ul>
			    <li><a href="entree_stock.php" ><span>Entree Stock</span></a></li>
			    <li><a href="sortie_stock.php"><span>Sortie Stock</span></a></li>
			    <li><a href="inven_stock.php"><span>Inventaire</span></a></li>
			    <li><a href="#" class="active" ><span>Articles</span></a></li>
			    <li><a href="employee.php"><span>Employés</span></a></li>
			    <li><a href="client.php"><span>Clients</span></a></li>
			    <li><a href="fournisseur.php"><span>Fournisseurs</span></a></li>
			</ul>
		</div>
		<!-- End Main Nav -->
	</div>
</div>
<!-- End Header -->

<!-- Container -->
<div id="container">
	<div class="shell">
		
		
		<br />
		<!-- Main -->
		<div id="main">
			<div class="cl">&nbsp;</div>
			
			<!-- Content -->
			<div id="content">
				
				<!-- Box -->
				<div class="box">
					<!-- Box Head -->
					<div class="box-head">
						<h2 class="left">Mes Articles</h2>
					</div>
					<!-- End Box Head -->	

					<!-- Table -->
					<div class="table">
						<table width="100%" border="0" cellspacing="0" cellpadding="0">

							<tr>
								<th>Article ID</th>
								<th>title</th>
								<th>Cat ID</th>
								<th>Um ID</th>
								<th width="110" class="ac">Parametres</th>
							</tr>


							<?php

							$dbt = new PDO('mysql:host=localhost;dbname=gestion_stock','root','');

							if (isset($_POST['filtre_type']) && isset($_POST['filtre'])) {
								$sql="SELECT * FROM article order by ".$_POST['filtre_type']."";


							}
							else $sql = "SELECT * FROM article order by art_id";

	$reps=$dbt->query($sql);
	while($donne = $reps->fetch())
	{
		echo  "<tr>
								<td>".$donne['art_id']."</td>
								<td><h3>".$donne['art_dis']."</h3></td>
								<td>".$donne['cat_id']."</td>
								<td>".$donne['um_id']."</td>
								<td><a href='http://localhost/Employ00/article.php?sup=1&art_id=".$donne['art_id']."' class='ico del'>Supprimer</a><a href='http://localhost/Employ00/modif/modif_art.php?art_id=".$donne['art_id']."' class='ico edit'>Modifier</a></td>
							</tr> " ;
	}

	echo '</table>';
	?>
							
						</table>
						
					</div>
					<!-- Table -->
					
				</div>
				<!-- End Box -->
				
				<!-- Box -->
				<div class="box" id="add_new_art" style="display: none">
					<!-- Box Head -->
					<div class="box-head">
						<h2>Ajouter Un nouveau Article</h2>
					</div>
					<!-- End Box Head -->
					
					<form action="article.php" method="post">
						
						<!-- Form -->
						<div class="form">


								<p>
									<span class="req">max 100 symbols</span>
									<label>Article ID <span>(Required Field)</span></label>
									<input name="art_id" type="text" class="field size1" />
								</p>	

								<p>
									<span class="req">max 100 symbols</span>
									<label>Article Title <span>(Required Field)</span></label>
									<input name="art_dis" type="text" class="field size1" />
								</p>	
								<p class="inline-field">
									<label>Categorie</label>
									<select class="field size2" name="cat_id">
										<?php
			

			
			$reps=$dbt->query("SELECT * FROM categorie");
			while($donne = $reps->fetch())
			{
				echo "<option value=".$donne['cat_id'].">".$donne['cat_dis']."</option> " ;
			}
		?>
									</select>
								</p>

								<p class="inline-field">
									<label>Unite de Mesure</label>
									<select class="field size2" name="um_id">
										<?php
			$reps=$dbt->query("SELECT * FROM um");
			while($donne = $reps->fetch())
			{
				echo "<option value=".$donne['um_id'].">".$donne['um_dis']."</option> " ;
			}
		?>
									</select>
								</p>
							
						</div>
						<!-- End Form -->
						
						<!-- Form Buttons -->
						<div class="buttons">
							<input type="submit" class="button" value="submit" />
						</div>
						<!-- End Form Buttons -->
					</form>
				</div>
				<!-- End Box -->


				<!-- Box -->
				<div class="box" id="add_new_cat" style="display: none">
					<!-- Box Head -->
					<div class="box-head">
						<h2>Ajouter Une Nouvelle Catégorie</h2>
					</div>
					<!-- End Box Head -->


					<div class="box">

					<!-- Table -->
					<div class="table">
						<table width="100%" border="0" cellspacing="0" cellpadding="0">

							<tr>
								<th>Cat ID</th>
								<th>Cat Des</th>
								<th width="110" class="ac">Content Control</th>
							</tr>


							<?php

									$reps=$dbt->query("SELECT * FROM categorie");
	

	while($donne = $reps->fetch())
	{
		echo "<tr class='odd' > <td>".$donne['cat_id']."</td><td>".$donne['cat_dis']."</td><td><a href='http://localhost/Employ00/article.php?sup=1&cat_id=".$donne['cat_id']."' class='ico del'>Delete</a><a href='http://localhost/Employ00/modif/modif_cat.php?cat_id=".$donne['cat_id']."' class='ico edit'>Edit</a></td></tr> ";
	}


							 ?>
							
						</table>
						
					</div>
					<!-- END Table -->
					
				</div>
				<!-- End Box -->
					
					<form action="article.php" method="post">
						
						<!-- Form -->
						<div class="form">
								<p>
									<span class="req">max 100 symbols</span>
									<label>Cat Title <span>(Required Field)</span></label>
									<input name="cat_dis" type="text" class="field size1" required />
								</p>
							
						</div>
						<!-- End Form -->
						
						<!-- Form Buttons -->
						<div class="buttons">
							<input type="submit" class="button" value="submit" />
						</div>
						<!-- End Form Buttons -->
					</form>
				</div>
				<!-- End Box -->

				<!-- Box -->
				<div class="box" id="add_new_um" style="display: none">
					<!-- Box Head -->
					<div class="box-head">
						<h2>Ajouter une Nouvelle UM</h2>
					</div>
					<!-- End Box Head -->


					<div class="box">

					<!-- Table -->
					<div class="table">
						<table width="100%" border="0" cellspacing="0" cellpadding="0">

							<tr>
								<th>Um ID</th>
								<th>Um Des</th>
								<th width="110" class="ac">Content Control</th>
							</tr>


							<?php

									$reps=$dbt->query("SELECT * FROM um");
	

	while($donne = $reps->fetch())
	{
		echo "<tr class='odd' > <td>".$donne['um_id']."</td><td>".$donne['um_dis']."</td><td><a href='http://localhost/Employ00/article.php?sup=1&um_id=".$donne['um_id']."' class='ico del'>Delete</a><a href='http://localhost/Employ00/modif/modif_um.php?um_id=".$donne['um_id']."' class='ico edit'>Edit</a></td></tr> ";
	}


							 ?>
							
						</table>
						
					</div>
					<!-- END Table -->
					
				</div>
				<!-- End Box -->
					
					<form action="article.php" method="post">
						
						<!-- Form -->
						<div class="form">

								<p>
									<span class="req">max 100 symbols</span>
									<label>Um Title <span>(Required Field)</span></label>
									<input name="um_dis" type="text" class="field size1" />
								</p>
							
						</div>
						<!-- End Form -->
						
						<!-- Form Buttons -->
						<div class="buttons">
							<input type="submit" class="button" value="submit" />
						</div>
						<!-- End Form Buttons -->
					</form>
				</div>
				<!-- End Box -->

			</div>
			<!-- End Content -->
			
			<!-- Sidebar -->
			<div id="sidebar">
				
				<!-- Box -->
				<div class="box">
					
					<!-- Box Head -->
					<div class="box-head">
						<h2>Management</h2>
					</div>
					<!-- End Box Head-->
					
					<div class="box-content">
						<a href="#" class="add-button" onclick='toggle("add_new_art")'><span >nv Article</span></a>
						<div class="cl">&nbsp;</div><br>
						<a href="#" class="add-button" onclick='toggle("add_new_cat")'><span >nv categorie</span></a>
						<div class="cl">&nbsp;</div><br>
						<a href="#" class="add-button" onclick='toggle("add_new_um")'><span >nv Unite </span></a>
						<div class="cl">&nbsp;</div><br>
						<!-- Sort -->
						<form class="sort" method="post" action="article.php">
							<label>Sort by</label>
							<select class="field" name="filtre_type">
								<option name='filtre_type' value="art_id">Article ID</option>
								<option name='filtre_type' value="art_dis">title</option>
								<option name='filtre_type' value="cat_id">Categorie</option>
								<option name='filtre_type' value="um_id">Unite de Mesure</option>
							</select> <br>
							<input class="button" type="submit" name="filtre" value="filtrer">
						</form>
						<!-- End Sort -->
						
					</div>
				</div>
				<!-- End Box -->
			</div>
			<!-- End Sidebar -->
			
			<div class="cl">&nbsp;</div>			
		</div>
		<!-- Main -->
	</div>
</div>
<!-- End Container -->

<!-- Footer -->
<div id="footer">
	<div class="shell">
		<span class="left">&copy; 2017 - ENIAC IT</span>

	</div>
</div>
<!-- End Footer -->


<script type="text/javascript">
	
	function toggle(ID)
	{
		art = document.getElementById('add_new_art');
		cat = document.getElementById('add_new_cat');
		um = document.getElementById('add_new_um');

		switch (ID)
		{
			case 'add_new_art' : art.style.display = 'block'; cat.style.display = um.style.display = 'none';   break;
			case 'add_new_cat' : cat.style.display = 'block'; art.style.display = um.style.display = 'none';   break;
			case 'add_new_um' :  um.style.display = 'block'; cat.style.display = art.style.display = 'none';   break;
			default : art.style.display = cat.style.display = um.style.display = 'none'
		}

	}

	</script>
	
</body>
</html>

<?php 

		
		$dbt = new PDO('mysql:host=localhost;dbname=gestion_stock','root','');
	
	

if(isset($_POST['art_id']) && isset($_POST['art_dis']) && isset($_POST['cat_id']) && isset($_POST['um_id']) )
{
	$art_id=$_POST["art_id"];
	$art_dis=$_POST["art_dis"];
	$cat_id=$_POST["cat_id"];
	$um_id=$_POST["um_id"];


	$sql="INSERT INTO article (art_id,art_dis,cat_id,um_id) VALUES  ('$art_id','$art_dis','$cat_id','$um_id')";

//	echo $sql;
		
		$rep=$dbt->query($sql);
		echo "<script type='text/javascript'>document.location.replace('article.php');</script>";

}


else if (isset($_POST['cat_dis'])) {

		$var=$_POST['cat_dis'];
		$sql= " INSERT INTO categorie (cat_dis) VALUES  ('$var') ";
//echo $sql;
		$rep=$dbt->query($sql);
		echo "<script type='text/javascript'>document.location.replace('article.php');</script>";
	}

else if (isset($_POST['um_dis'])) {

		$var=$_POST['um_dis'];
		$sql="INSERT INTO um (um_dis) VALUES  ('$var')";
//		echo $sql;
		$rep=$dbt->query($sql);

		echo "<script type='text/javascript'>document.location.replace('article.php');</script>";
		
	}

else if (isset($_GET['art_id']) && isset($_GET['sup']))
	 {
		$art_id1=$_GET["art_id"];
		$sqls="DELETE FROM article WHERE art_id='$art_id1'  ";

//		echo $sqls;

		$rep=$dbt->query($sqls);
		echo "<script type='text/javascript'>document.location.replace('article.php');</script>";

	}

else if (isset($_GET['um_id']) && isset($_GET['sup']))
	 {
		$art_id1=$_GET["um_id"];
		$sqls="DELETE FROM um WHERE um_id='$art_id1'";

//echo $sqls;
		$rep=$dbt->query($sqls);
		echo "<script type='text/javascript'>document.location.replace('article.php');</script>";
		
	}

else if (isset($_GET['cat_id']) && isset($_GET['sup']))
	 {
		$art_id1=$_GET["cat_id"];
		$sqls="DELETE FROM categorie WHERE cat_id='$art_id1'";
//echo $sqls;

		$rep=$dbt->query($sqls);
		echo "<script type='text/javascript'>document.location.replace('article.php');</script>";

	}
?>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              