<?php
/* Displays user information and some useful messages */
session_start();

// Check if user is logged in using the session variable
if ( $_SESSION['logged_in'] != 1 ) {
  $_SESSION['message'] = "You must log in first!";
  header("location: error.php");    
}
else {
    // Makes it easier to read
    $first_name = $_SESSION['first_name'];
    $last_name = $_SESSION['last_name'];
    $email = $_SESSION['email'];
    
}
?>


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Gestionnaire De Stock</title>
	<link rel="stylesheet" href="css/style.css" type="text/css" media="all" />
</head>
<body>
<!-- Header -->
<div id="header">
	<div class="shell">
		<!-- Logo + Top Nav -->
		<div id="top">
			<h1><a href="#">Employés</a></h1>
			<div id="top-navigation">
				Bonjour, <a href="profile.php"><strong><?php echo $first_name ; ?></strong></a>
				<span>|</span>
				<a href="modif/modif_usr.php">Parametres De Profile</a>
				<span>|</span>
				<a href="logout.php">Déconnexion</a>
			</div>
		</div>
		<!-- End Logo + Top Nav -->
		
		<!-- Main Nav -->
		<div id="navigation">
			<ul>
			    <li><a href="entree_stock.php" ><span>Entree Stock</span></a></li>
			    <li><a href="sortie_stock.php"><span>Sortie Stock</span></a></li>
			    <li><a href="inven_stock.php"><span>Inventaire</span></a></li>
			    <li><a href="article.php"><span>Articles</span></a></li>
			    <li><a href="#" class="active" ><span>Employés</span></a></li>
			    <li><a href="client.php"><span>Clients</span></a></li>
			    <li><a href="fournisseur.php"><span>Fournisseurs</span></a></li>
			</ul>
		</div>
		<!-- End Main Nav -->
	</div>
</div>
<!-- End Header -->

<!-- Container -->
<div id="container">
	<div class="shell">
		<br />
		<!-- Main -->
		<div id="main">
			<div class="cl">&nbsp;</div>
			
			<!-- Content -->
			<div id="content">
				
				<!-- Box -->
				<div class="box">
					<!-- Box Head -->
					<div class="box-head">
						<h2 class="left">Mes Employés</h2>
					</div>
					<!-- End Box Head -->	

					<!-- Table -->
					<div class="table">
						<table width="100%" border="0" cellspacing="0" cellpadding="0">

							<tr>
								
								<th>id</th>
								<th>Nom</th>
								<th>Prénom</th>
								<th>Téléphone</th>
								<th>E-mail</th>
								<th>Activé/Desactivé</th>
								<th>Role</th>
								<th width="110" class="ac">Parametres</th>
							</tr>


							<?php

							$dbt = new PDO('mysql:host=localhost;dbname=gestion_stock','root','');

							if (isset($_POST['filtre_type']) && isset($_POST['filtre'])) {
								$sql="SELECT * FROM employe order by ".$_POST['filtre_type']."";


							}
							else $sql = "SELECT * FROM employe ";

	$reps=$dbt->query($sql);
	while($donne = $reps->fetch())
	{
		echo  "<tr>
								
								<td><h3>".$donne['id']."</h3></td>
								<td>".$donne['nom']."</td>
								<td>".$donne['prenom']."</td>
								<td>".$donne['tel']."</td>
								<td>".$donne['email']."</td>
								<td>".$donne['active']."</td>
								<td>".$donne['role']."</td>
								<td><a href='http://localhost/Employ00/employee.php?sup=1&id=".$donne['id']."' class='ico del'>Supprimer</a><a href='http://localhost/Employ00/modif/modif_empl.php?id=".$donne['id']."' class='ico edit'>Modifier</a></td>
							</tr> " ;
	}


	?>
							
						</table>
						
					</div>
					<!-- Table -->
					
				</div>
				<!-- End Box -->
				
				<!-- Box -->
				<div class="box" id="add_new_empl" style="display: none">
					<!-- Box Head -->
					<div class="box-head">
						<h2>Add New Employe</h2>
					</div>
					<!-- End Box Head -->

					<?php
						if($_SESSION['role']=="admin" )

							echo '<form action="employee.php" method="post">
						
						<!-- Form -->
						<div class="form">


									
								<p>
									<span class="req">max 100 symbols</span>
									<label>Nom <span>(Required Field)</span></label>
									<input name="nom" type="text" class="field size1" />
								</p>

								<p>
									<span class="req">max 100 symbols</span>
									<label>Prenom <span>(Required Field)</span></label>
									<input name="prenom" type="text" class="field size1" />
								</p>
								<p>
									<span class="req">max 100 symbols</span>
									<label>E-mail <span>(Required Field)</span></label>
									<input name="email" type="email" class="field size1" />
								</p>
								<p>
									<span class="req">max 100 symbols</span>
									<label>Mot de Passe <span>(Required Field)</span></label>
									<input name="mdp" type="password" class="field size1" />
								</p>
								
								<p>
									<span class="req">max 100 symbols</span>
									<label>tel <span>(Required Field)</span></label>
									<input name="tel" type="tel" class="field size1" />
								</p>

								<p>
									<span class="req">max 100 symbols</span>
									<label>role  <span>(Champs Obligatoire)</span></label>
									<select name="role" class="field size1">
									<option value="std"> standard </option>
									<option value="admin"> Administrateur </option>
									</select> 
												</p>

								<p>
									<span class="req">max 100 symbols</span>
									<label>Etat De Compte<span>(Champs Obligatoire)</span></label>
									<select name="active" class="field size1">
									<option value=0> Desactivé </option>
									<option value=1> Activé </option>
									</select> 
								</p>	
									
								
							
						</div>
						<!-- End Form -->
						
						<!-- Form Buttons -->
						<div class="buttons">
							<input type="submit" class="button" value="submit" />
						</div>
						<!-- End Form Buttons -->
					</form>';

					else 
						echo " <p> Vous n'etes pas autorisé pour effectuer cette operation </p>";


					 ?>
					
					
				</div>
				<!-- End Box -->


				<!-- Box -->

			</div>
			<!-- End Content -->
			
			<!-- Sidebar -->
			<div id="sidebar">
				
				<!-- Box -->
				<div class="box">
					
					<!-- Box Head -->
					<div class="box-head">
						<h2>Management</h2>
					</div>
					<!-- End Box Head-->
					
					<div class="box-content">
						<a href="#" class="add-button" onclick='toggle("add_new_empl")'><span >nv Employe</span></a>
						<div class="cl">&nbsp;</div><br>
						<!-- Sort -->
						<form class="sort" method="post" action="employee.php">
							<label>Sort by</label>
							<select class="field" name="filtre_type">
								
								<option name='filtre_type' value="nom">Nom</option>
								<option name='filtre_type' value="prenom">Prenom</option>
							</select> <br>
							<input class="button" type="submit" name="filtre" value="filtrer">
						</form>
						<!-- End Sort -->
						
					</div>
				</div>
				<!-- End Box -->
			</div>
			<!-- End Sidebar -->
			
			<div class="cl">&nbsp;</div>			
		</div>
		<!-- Main -->
	</div>
</div>
<!-- End Container -->

<!-- Footer -->
<div id="footer">
	<div class="shell">
		<span class="left">&copy; 2017 - ENIAC IT</span>

	</div>
</div>
<!-- End Footer -->


<script type="text/javascript">
	
	function toggle(ID)
	{
		X = document.getElementById('add_new_empl');

		if(X.style.display === 'none')
			X.style.display = 'block';
		else 
			X.style.display =  'none';
		
	}

	</script>
	
</body>
</html>

<?php 

		
		$dbt = new PDO('mysql:host=localhost;dbname=gestion_stock','root','');





if(isset($_POST['nom']) && isset($_POST['prenom'])&& isset($_POST['mdp'])&& isset($_POST['tel']) && isset($_POST['role'])&& isset($_POST['active'])&& isset($_POST['email'])  )
{
		
		$mdp= md5($_POST["mdp"]) ;
		$nom=$_POST["nom"];
		$prenom=$_POST["prenom"];
		$tel=$_POST["tel"];
		$email=$_POST["email"];
		$active=$_POST["active"];
		$role=$_POST["role"];

		$sql="INSERT INTO employe (mdp,nom,prenom,tel,email,active,role) VALUES  ('$mdp','$nom','$prenom','$tel','$email','$active','$role')";
		$reps=$dbt->query($sql);
		echo "<script type='text/javascript'>document.location.replace('employee.php');</script>";
	
}


else if (isset($_GET['id']) && isset($_GET['sup']))
	{

	 	if($_SESSION['role'] != "admin" )
		{
				$_SESSION['message'] = " Vous n'etes pas autorisée pour éffectuer cette operation ";
	 			echo "<script type='text/javascript'>document.location.replace('error.php');</script>";
	 			
		}
		else
		{
			$login1=$_GET["id"];
			$sqls="DELETE FROM employe WHERE id='$login1'";
			$dbt->query($sqls);
			echo "<script type='text/javascript'>document.location.replace('employee.php');</script>";
		}

	}


?>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          